import streamlit as st
import speech_recognition as sr
from gtts import gTTS
import os
import time

# ЁЯОд Voice Input
def get_voice_input():
    r = sr.Recognizer()
    with sr.Microphone() as source:
        st.info("ЁЯОЩя╕П рдмреЛрд▓рд┐рдП, рдореИрдВ рд╕реБрди рд░рд╣рд╛ рд╣реВрдБ...")
        audio = r.listen(source, timeout=5)
    try:
        text = r.recognize_google(audio, language='hi-IN')
        st.success(f"рдЖрдкрдиреЗ рдкреВрдЫрд╛: {text}")
        return text
    except Exception as e:
        st.error("тЪая╕П рдХреБрдЫ рд╕рдордЭ рдирд╣реАрдВ рдЖрдпрд╛, рдХреГрдкрдпрд╛ рджреЛрдмрд╛рд░рд╛ рдмреЛрд▓реЗрдВред")
        return ""

# ЁЯФК Text-to-Speech
def speak(text, lang='hi'):
    tts = gTTS(text=text, lang=lang)
    filename = "output.mp3"
    tts.save(filename)
    os.system("start output.mp3" if os.name == "nt" else f"mpg123 {filename}")
    time.sleep(2)

# ЁЯУЪ Simple Question-Answer Bank (рдЖрдк рдЗрд╕реЗ рдмрдбрд╝рд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ)
qa_bank = {
    "рдиреНрдпреВрдЯрди рдХрд╛ рдкрд╣рд▓рд╛ рдирд┐рдпрдо": "рдпрджрд┐ рдХреЛрдИ рд╡рд╕реНрддреБ рд╕реНрдерд┐рд░ рд╣реИ рдпрд╛ рдЧрддрд┐ рдХрд░ рд░рд╣реА рд╣реИ, рддреЛ рд╡рд╣ рддрдм рддрдХ рд╡реИрд╕реА рд╣реА рд░рд╣реЗрдЧреА рдЬрдм рддрдХ рдЙрд╕ рдкрд░ рдХреЛрдИ рдмрд╛рд╣рд░реА рдмрд▓ рди рд▓рдЧреЗред",
    "рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг рдХреНрдпрд╛ рд╣реИ": "рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг рд╡рд╣ рдмрд▓ рд╣реИ рдЬреЛ рдкреГрдереНрд╡реА рд╣рдореЗрдВ рдЕрдкрдиреА рдУрд░ рдЦреАрдВрдЪрддреА рд╣реИред",
    "рдкреГрдереНрд╡реА рдХрд╛ рдЙрдкрдЧреНрд░рд╣": "рдЪрдВрджреНрд░рдорд╛ рдкреГрдереНрд╡реА рдХрд╛ рдПрдХрдорд╛рддреНрд░ рдкреНрд░рд╛рдХреГрддрд┐рдХ рдЙрдкрдЧреНрд░рд╣ рд╣реИред",
    "рддрд╛рдкрди рдХреЗ рдкреНрд░рдХрд╛рд░": "рддреАрди рдкреНрд░рдХрд╛рд░ рдХреЗ рддрд╛рдкрди рд╣реИрдВ: рдЪрд╛рд▓рди, рд╕рдВрд╡рд╣рди рдФрд░ рд╡рд┐рдХрд┐рд░рдгред"
}

# ЁЯОУ Streamlit UI
st.title("ЁЯУЪ AI рдЯреАрдЪрд░ тАФ рдЖрдкрдХреА рдЦреБрдж рдХреА рд╡рд░реНрдЪреБрдЕрд▓ рдХреНрд▓рд╛рд╕!")
st.write("рдмреЛрд▓рдХрд░ рд╕рд╡рд╛рд▓ рдкреВрдЫрд┐рдП рдФрд░ рдЬрд╡рд╛рдм рд╕реБрдирд┐рдПред")

# ЁЯОд Voice Question
if st.button("ЁЯОЩя╕П рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ (рдмреЛрд▓реЗрдВ)"):
    question = get_voice_input()

    # ЁЯдЦ Match from Q-A Bank
    found = False
    for q in qa_bank:
        if q in question:
            answer = qa_bank[q]
            st.success(f"рдЬрд╡рд╛рдм: {answer}")
            speak(answer)
            found = True
            break
    if not found:
        msg = "рдорд╛рдлрд╝ рдХреАрдЬрд┐рдП, рдпрд╣ рд╕рд╡рд╛рд▓ рдореЗрд░реЗ рдкрд╛рд╕ рдЕрднреА рдирд╣реАрдВ рд╣реИред"
        st.warning(msg)
        speak(msg)
